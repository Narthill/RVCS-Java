<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>NETTY SOCKET.IO DEMO</title>
    <base />
    <link
      href="https://cdn.bootcss.com/bootstrap/4.0.0-alpha.6/css/bootstrap.css"
      rel="stylesheet"
    />
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.4/socket.io.js"></script>
    <style>
      body {
        padding: 20px;
      }
      #console {
        height: 450px;
        overflow: auto;
      }
      .username-msg {
        color: orange;
      }
      .connect-msg {
        color: green;
      }
      .disconnect-msg {
        color: red;
      }
    </style>
  </head>

  <body>
    <div id="console" class="well"></div>
    <input id="userId" type="text" />
    <input id="connect" type="button" onClick="connect()" value="登录" />
    <input id="disconnect" type="button" onClick="sendDisconnect()" value="断开连接"/>

    <br/>
    群号:
    <input id="groupId" type="text" />
    <input id="msg" type="text" />
    <input id="send" type="button" onClick="sendMessage()" value="发送" />
  </body>
  <script type="text/javascript">
    var socket;

    var userId;
    var groupId;
    function connect() {
      userId = $("#userId").val();
      groupId = $("#groupId").val();
      var opts = {
        query: "userId=" + userId
      };
      socket = io.connect("http://192.168.1.106:9099", opts);
      socket.on("connect", function() {
        console.log("连接成功");
        serverOutput('<span class="connect-msg">连接成功</span>');
      });

      socket.on("groupChatEvent", function(data) {
        output("<span>" + data.userId + ": </span>" + data.message);
        console.log(data);
      });

      socket.on("disconnect", function() {
        serverOutput('<span class="disconnect-msg">' + "已下线! </span>");
      });
    }

    function sendDisconnect() {
      socket.disconnect();
    }

    function output(message) {
      var element = $("<div>" + message + "</div>");
      $("#console").prepend(element);
    }

    function sendMessage() {
      var message = $("#msg").val();
      $("#msg").val("");

      var jsonObject = { userId: userId, message: message,groupId:groupId};
      socket.emit("groupChatEvent", jsonObject);
    }

    function serverOutput(message) {
      var element = $("<div>" + message + "</div>");
      $("#console").prepend(element);
    }

    $(document).keydown(function(e){
        if(e.keyCode == 13) {
            $('#send').click();
        }
    });
  </script>
</html>
