<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>群聊demo</title>
    <link href="bootstrap.css" rel="stylesheet">
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.4/socket.io.js"></script>
    <style>
      body {
        padding: 20px;
      }
      #console {
        height: 450px;
        overflow: auto;
      }
      .username-msg {
        color: orange;
      }
      .connect-msg {
        color: green;
      }
      .disconnect-msg {
        color: red;
      }

        body {
        padding:20px;
      }
      #console {
        height: 400px;
        overflow: auto;
      }
    </style>
  </head>

  <body>
    
    <div id="console" class="well"></div>
    <!-- <form class="well form-inline" onsubmit="return false;"> -->
      名字:<input id="source" class="input-xlarge" type="text" />
      <br/>
      群名:<input id="groupId" class="input-xlarge" type="text" placeholder="如群1,群2,群3,群4"/>
      <input id="connect" type="button" class="btn" onClick="connect()" value="登录" />
      <input id="disconnect" type="button" class="btn" onClick="sendDisconnect()" value="断开连接"/>

      <br/>
      内容:<input id="msg" class="input-xlarge" type="text" />
      <input id="send" type="button" class="btn" onClick="sendMessage()" value="发送" />
    <!-- </form> -->
  </body>
  <script type="text/javascript">
    var socket;

    var source;
    var groupId;
    
    function connect() {
      source = $("#source").val();
      groupId = $("#groupId").val();
      var opts = {
        query: "source=" + source
      };
      socket = io.connect("http://127.0.0.1:9099", opts);
      socket.on("connect", function() {
        console.log("连接成功");
        serverOutput('<span class="connect-msg">连接成功</span>');
      });

      socket.on("groupChatEvent", function(data) {
        output('<span class="username-msg">' + data.source + ": </span>" + data.message);
        console.log(data);
      });

      socket.on("disconnect", function() {
        serverOutput('<span class="disconnect-msg">' + "已下线! </span>");
      });
    }

    function sendDisconnect() {
      socket.disconnect();
    }

    function output(message) {
      var element = $("<div>" + message + "</div>");
      $("#console").prepend(element);
    }

    function sendMessage() {
      var message = $("#msg").val();
      $("#msg").val("");

      var jsonObject = { source: source, message: message,groupId:groupId};
      socket.emit("groupChatEvent", jsonObject);
    }

    function serverOutput(message) {
      var element = $("<div>" + message + "</div>");
      $("#console").prepend(element);
    }

    $(document).keydown(function(e){
        if(e.keyCode == 13) {
            $('#send').click();
        }
    });
  </script>
</html>
